[Unit]
Description=Servarr Stack
Wants=network-online.target
After=network-online.target

[Service]
Type=notify
ExecStart=/usr/bin/podman pod create \
    --name servarr \
    -p 7878:7878 \
    -p 8989:8989 \
    -p 8686:8686 \
    -p 5075:5075 \
    -p 8096:8096 \
    -p 9696:9696 \
    -p 6767:6767 \
    -p 8080:8080 \
    -p 9117:9117 \
    -p 8181:8181 \
    -p 3579:3579 \
    -p 9091:9091 \
    -p 8787:8787 \
    -p 51413:51413 \
    -p 51413:51413/udp

ExecStartPost=/usr/bin/podman run --rm --pod servarr \
    --name wireguard \
    --cap-add=NET_ADMIN \
    --cap-add=NET_RAW \
    --cap-add=SYS_MODULE \
    --sysctl net.ipv6.conf.all.disable_ipv6=0 \
    --sysctl net.ipv4.conf.all.src_valid_mark=1 \
    -e PUID=1000 \
    -e PGID=1000 \
    -e TZ=America/New_York \
    -v /path/to/wg0.conf:/config/wg_confs/wg0.conf \
    -v /lib/modules:/lib/modules \
    -d \
    linuxserver/wireguard

ExecStartPost=/usr/bin/podman run --rm --pod servarr \
    --name transmission \
    --network container:wireguard \
    --env-file ./transmission.env \
    -e PUID=1000 \
    -e PGID=1000 \
    -e TZ=Etc/UTC \
    -v /path/to/transmission/data:/config \
    -v /path/to/downloads:/downloads \
    -v /path/to/watch/folder:/watch \
    -d \
    lscr.io/linuxserver/transmission:latest

ExecStartPost=/usr/bin/podman run --rm --pod servarr \
    --name lidarr \
    -e PUID=1000 \
    -e PGID=1000 \
    -e TZ=Etc/UTC \
    -v /path/to/lidarr/config:/config \
    -v /path/to/music:/music \
    -v /path/to/downloads:/downloads \
    -d \
    lscr.io/linuxserver/lidarr:latest

ExecStartPost=/usr/bin/podman run --rm --pod servarr \
    --name radarr \
    -e PUID=1000 \
    -e PGID=1000 \
    -e TZ=Etc/UTC \
    -v /path/to/radarr/data:/config \
    -v /path/to/movies:/movies \
    -v /path/to/download-client-downloads:/downloads \
    -d \
    lscr.io/linuxserver/radarr:latest

ExecStartPost=/usr/bin/podman run --rm --pod servarr \
    --name readarr \
    -e PUID=1000 \
    -e PGID=1000 \
    -e TZ=Etc/UTC \
    -v /path/to/data:/config \
    -v /path/to/books:/books \
    -v /path/to/downloadclient-downloads:/downloads \
    -d \
    lscr.io/linuxserver/readarr:develop

ExecStartPost=/usr/bin/podman run --rm --pod servarr \
    --name sonarr \
    -e PUID=1000 \
    -e PGID=1000 \
    -e TZ=Etc/UTC \
    -v /path/to/sonarr/data:/config \
    -v /path/to/tvseries:/tv \
    -v /path/to/downloadclient-downloads:/downloads \
    -d \
    lscr.io/linuxserver/sonarr:latest

ExecStartPost=/usr/bin/podman run --rm --pod servarr \
    --name prowlarr \
    -e PUID=1000 \
    -e PGID=1000 \
    -e TZ=Etc/UTC \
    -v /path/to/prowlarr/data:/config \
    -d \
    lscr.io/linuxserver/prowlarr:latest

ExecStartPost=/usr/bin/podman run --rm --pod servarr \
    --name jellyfin \
    -e PUID=1000 \
    -e PGID=1000 \
    -e TZ=Etc/UTC \
    -e JELLYFIN_PublishedServerUrl=http://192.168.0.5 \
    -v /path/to/jellyfin/library:/config \
    -v /path/to/tvseries:/data/tvshows \
    -v /path/to/movies:/data/movies \
    -p 8096:8096 \
    -p 8920:8920 \
    -p 7359:7359/udp \
    -p 1900:1900/udp \
    -d \
    lscr.io/linuxserver/jellyfin:latest

ExecStartPost=/usr/bin/podman run --rm --pod servarr \
    --name bazarr \
    -e PUID=1000 \
    -e PGID=1000 \
    -e TZ=Etc/UTC \
    -v /path/to/bazarr/config:/config \
    -v /path/to/movies:/movies \
    -v /path/to/tv:/tv \
    -d \
    lscr.io/linuxserver/bazarr:latest

ExecStartPost=/usr/bin/podman run --rm --pod servarr \
    --name jackett \
    -e PUID=1000 \
    -e PGID=1000 \
    -e TZ=Etc/UTC \
    -e AUTO_UPDATE=true \
    -v /path/to/jackett/data:/config \
    -v /path/to/blackhole:/downloads \
    -d \
    lscr.io/linuxserver/jackett:latest

ExecStartPost=/usr/bin/podman run --rm --pod servarr \
    --name tautulli \
    -e PUID=1000 \
    -e PGID=1000 \
    -e TZ=Etc/UTC \
    -v /path/to/tautulli/config:/config \
    -d \
    lscr.io/linuxserver/tautulli:latest

ExecStartPost=/usr/bin/podman run --rm --pod servarr \
    --name ombi \
    -e PUID=1000 \
    -e PGID=1000 \
    -e TZ=Etc/UTC \
    -v /path/to/ombi/config:/config \
    -d \
    lscr.io/linuxserver/ombi:latest

ExecStop=/usr/bin/podman pod stop servarr
ExecStopPost=/usr/bin/podman pod rm servarr

[Install]
WantedBy=multi-user.target